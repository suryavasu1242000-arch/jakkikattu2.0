<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jallikattu Token | Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="dashboard-page">

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container nav-content">
            <h2 class="logo">Jallikattu<span>Token</span></h2>
            <button id="logoutBtn" class="btn-outline">Logout</button>
        </div>
    </nav>

    <div class="container main-content">

        <!-- Action Tabs -->
        <div class="tabs">
            <button class="tab-btn" data-tab="register">Register Bull</button>
            <button class="tab-btn" data-tab="online-requests">
                Online Requests <span id="pendingBadge" class="badge" style="display:none;">0</span>
            </button>
            <button class="tab-btn" data-tab="scan">Verify / Scan</button>
            <button class="tab-btn" data-tab="list">All Entries</button>
        </div>

        <!-- Registration Section -->
        <div id="register" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h3>New Bull Registration</h3>
                </div>
                <form id="registrationForm">
                    <div class="form-grid">
                        <div class="input-group">
                            <label for="bullName">Bull Name (Kaalai)</label>
                            <input type="text" id="bullName" required>
                        </div>
                        <div class="input-group">
                            <label for="ownerName">Owner Name</label>
                            <input type="text" id="ownerName" required>
                        </div>
                        <div class="input-group">
                            <label for="tokenNumber">Token Number</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="tokenNumber" placeholder="Enter or Generate" required>
                                <button type="button" id="generateTokenBtn" class="btn-outline"
                                    style="width: auto; padding: 10px;">Generate</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="bullPhoto">Bull Photo</label>
                            <input type="file" id="bullPhoto" accept="image/*">
                        </div>
                    </div>

                    <!-- QR Selection Removed as per request (Defaulting to Software QR) -->

                    <button type="submit" class="btn-primary" id="saveBtn">Save Registration</button>
                </form>

                <!-- Generated QR Display -->
                <div id="generatedQrResult" class="result-box" style="display: none;">
                    <h4>Registration Successful!</h4>
                    <div id="qrcode"></div>
                    <p class="token-display">Token: <span id="displayToken"></span></p>
                    <button class="btn-outline" onclick="window.print()">Print Token</button>
                </div>
            </div>
        </div>

        <!-- Online Requests Section (New) -->
        <div id="online-requests" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>Pending Applications</h3>
                    <button class="btn-outline" onclick="loadPendingRequests()">Refresh</button>
                </div>
                <div class="table-responsive">
                    <table class="bull-table">
                        <thead>
                            <tr>
                                <th>Photo</th>
                                <th>Details</th>
                                <th>Place / Mobile</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pendingRequestsBody">
                            <!-- Dynamic Pending Requests -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Verification Scanner Section -->
        <div id="scan" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h3>Verify Entry</h3>
                </div>
                <div class="scanner-wrapper">
                    <div id="verify-reader"></div>
                    <p class="scan-instructions">Point camera at the Bull's Token QR or Barcode</p>
                </div>
            </div>
        </div>

        <!-- List Section -->
        <div id="list" class="tab-content">
            <div class="card">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Registered Bulls</h3>
                    <button id="exportBtn" class="btn-primary"
                        style="width: auto; margin-top: 0; background-color: #2E7D32;">Export Excel</button>
                </div>
                <div class="table-responsive">
                    <table class="bull-table">
                        <thead>
                            <tr>
                                <th>Token</th>
                                <th>Bull Name</th>
                                <th>Owner</th>
                                <th>Contact / Place</th>
                                <th>Photo</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bullsTableBody">
                            <!-- Dynamic Content -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- Printable Area (Hidden on screen) -->
    <div id="printableArea" style="display: none;">
        <h2>Jallikattu 2026</h2>
        <div id="printQrContainer"></div>
        <p id="printTokenNo">Token: </p>
        <p id="printBullName"></p>
        <p id="printOwnerName"></p>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="js/dashboard.js"></script>
</body>

</html>